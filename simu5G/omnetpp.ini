[General]
cmdenv-autoflush = true
network = simu5g.simulations.NR.cars.Highway

# --- AÑADIDO: Activación y configuración de archivos de resultados ---
output-vector-file = results/results.vec
output-scalar-file = results/results.sca
**.vector-recording = true
**.scalar-recording = true

##########################################################
#           Parámetros de Simulación                     #
##########################################################
debug-on-errors = false
print-undisposed = false
sim-time-limit = 100s

**.sctp.**.scalar-recording = false
**.sctp.**.vector-recording = false
**.routingRecorder.enabled = false

*.playgroundSizeX = 20000m
*.playgroundSizeY = 20000m
*.playgroundSizeZ = 50m

##########################################################
#           Parámetros de VeinsManager                   #
##########################################################
*.veinsManager.host = "localhost"
*.veinsManager.moduleType = "simu5g.nodes.cars.NRCar"
*.veinsManager.moduleName = "car"
*.veinsManager.launchConfig = xmldoc("heterogeneous.launchd.xml")
*.veinsManager.updateInterval = 0.1s

##########################################################
#           Movilidad                                    #
##########################################################
*.car[*].mobility.typename = "VeinsInetMobility"

##########################################################
#           Parámetros Específicos de Red Móvil          #
##########################################################

# --- PARÁMETROS DE DUAL CONNECTIVITY (DC) ---
**.dualConnectivityEnabled = true
*.masterEnb.cellularNic.typename = "LteNicEnbD2D"
*.gNodeB1.masterId = 2

# --- Configuración General de Red ---
**.numBands = 25
**.ueTxPower = 26dBm
**.eNodeBTxPower = 46dBm

# --- Configuración de Asociación de Celda y Handover para DC ---
*.car[*].cellularNic.nrPhy.dynamicCellAssociation = true
*.car[*].cellularNic.nrPhy.enableHandover = true

# --- AÑADIDO: Habilitar grabación de Handovers ---
*.car[*].cellularNic.mac.scalar-recording = true

# Se asignan los roles de Master (eNB) y Secondary (gNB) al coche
*.car[*].masterId = 2
*.car[*].macCellId = 2
*.car[*].nrMasterId = 1
*.car[*].nrMacCellId = 1

# --- Configuración de e/gNodeB ---
*.gNodeB1.macCellId = 1
*.gNodeB1.macNodeId = 1
*.masterEnb.macCellId = 2
*.masterEnb.macNodeId = 2

# --- Configuración de Handover y X2 ---
*.gNodeB*.cellularNic.phy.enableHandover = true
*.masterEnb.cellularNic.phy.enableHandover = true
*.gNodeB*.cellularNic.phy.handoverLatency = 50ms
*.masterEnb.cellularNic.phy.handoverLatency = 50ms
*.gNodeB*.cellInfo.broadcastMessageInterval = 1s
*.masterEnb.cellInfo.broadcastMessageInterval = 1s

# Un X2 app por cada par de nodos
*.masterEnb.numX2Apps = 1
*.gNodeB1.numX2Apps = 1
*.masterEnb.x2App[0].server.localPort = 5001
*.gNodeB1.x2App[0].server.localPort = 5000
*.masterEnb.x2App[0].client.connectAddress = "gNodeB1%x2ppp0"
*.gNodeB1.x2App[0].client.connectAddress = "masterEnb%x2ppp0"

**.sctp.nagleEnabled = false
**.sctp.enableHeartbeats = false

# ----------------------------------------------------------------------------- #
# Config "Cars-SplitBearer-DL"
#
[Config Cars-SplitBearer-DL]
description = "Dual Connectivity con Split Bearer en Downlink para coches"

# --- Configuración de la Aplicación ---
*.server.numApps = 10
*.server.app[*].typename = "VoIPSender"
*.server.app[*].destAddress = "car[" + string(ancestorIndex(0)) + "]"
*.server.app[*].destPort = 3000
*.server.app[*].startTime = uniform(0.1s, 0.5s)
*.server.app[*].tos = 20

*.car[*].numApps = 1
*.car[*].app[0].typename = "VoIPReceiver"
*.car[*].app[0].localPort = 3000

# --- AÑADIDO: Habilitar grabación de Throughput y Latencia ---
*.car[*].app[0].scalar-recording = true
*.car[*].app[0].vector-recording = true